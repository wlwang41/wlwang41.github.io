<!DOCTYPE HTML>
<html>
    <head>
        <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
        <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
        <title>前端页面性能优化 - crow coffin</title>
        <meta name="keywords" content="python web"/>
        <meta name="description" content="Learning in the hard way."/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="header">
            <ul>
                <li>
                    <a href="/" style="color: wheat;border-right: solid 1px gray;">crow coffin</a>
                </li>
                <li>
                    <a href="https://github.com/wlwang41" target="_blank">my github</a>
                </li>
                <li>
                    <a href="http://about.me/wlwang41" target="_blank">about.me</a>
                </li>
                <li>
                    <a href="http://aboutcrow.herokuapp.com/" target="_blank">resume</a>
                </li>
                <li>
                    <a href="mailto:wlwang41@gmail.com">email</a>
                </li>
            </ul>
        </div>
        <div id="container">
            
    <div id="content_header">
        <div id="post-nav">
            
            <a href="/">Home</a> » <a href="/#ops">ops</a> » 前端页面性能优化
            
        </div>
    </div>
    <div class="clearfix"></div>
    <div id="title">前端页面性能优化</div>
    <div id="content">
        <p>趁着周末会武汉参加同学会的机会, 在火车上终于把《高性能建站指南》看完了.哎, 收藏了那么多优质的电子书, 要么没时间看, 有时间的时候又不记得看, 现在唯一看书的机会就是火车上了.(上次回武汉考驾照在火车上把蝴蝶书给看了, 对js一些奇奇怪怪的感觉瞬间就明了了)</p>
<p>这篇文章就作为一个总结吧(好吧, 其实就是书的目录).</p>
<h2 id="http">减少HTTP的请求</h2>
<p>这个很好理解, 本身http就是很耗时的, 最简单直接的做法当然就是尽可能少的发出HTTP的请求.</p>
<ul>
<li>
<p>Image Maps</p>
<p>将多个图片合并到一张, 通过<code>map</code>标签声明各个图片的位置, 然后用<code>img</code>的<code>usemap</code>属性指明图片所以来的map标签</p>
</li>
<li>
<p>CSS Sprites</p>
<p>雪碧图也是把多个icon放到一张图片中, 然后通过css的<code>background</code>属性引入进来, 并且通过<code>background-position</code>来指明图片在大图中的位置.</p>
</li>
<li>
<p>Inline Images</p>
<p>通过data: URL的模式在web页面中包含图片而且不需要http请求.</p>
</li>
<li>
<p>Combined Scripts and Stylesheets</p>
<p>合并js和css这个不必多少, 特别是用<a href="http://requirejs.org/">require.js</a>, 既能保证模块化的思想也能压缩js.</p>
</li>
</ul>
<h2 id="_1">使用内容发布网络</h2>
<p>用CDN托管静态资源, 大家都是这么干的.</p>
<h2 id="expires">添加Expires头</h2>
<p>通过设置<code>Expires</code>, <code>Cache-Control: max-age=xxx</code>来让浏览器做一些必要的缓存, 从而减少HTTP请求</p>
<h2 id="_2">压缩组件</h2>
<p>通过设置头<code>Accept-Encoding: gzip, deflate</code>表示浏览器支持的压缩格式, 服务器返回的头中通过<code>Content-Encoding: gzip</code>来表示服务器返回的数据压缩格式</p>
<h2 id="_3">将样式表放在顶部</h2>
<p>如果不放在顶部会有白屏或是无样式内容的闪烁现象, 这是因为如果样式不先加载进来, 那么浏览器先渲染好dom元素之后又要有结构样式上的改变, 就会造成白屏或是闪烁现象.</p>
<p>实际上在HTML的规范中, <code>link</code>只能出现在<code>head</code>之中, 而之所以浏览器支持把<code>link</code>放到<code>head</code>外面纯粹是为了解决历史遗留问题.所以遵守规范总是好的.</p>
<h2 id="_4">将脚本放到底部</h2>
<p>脚本不影响页面渲染的情况下把他放到最下面, 先让用户看到页面.</p>
<p>在HTTP 1.1规范中建议浏览器从每个主机名并行的下载2个组件(也可以自己配置), 但是如果有脚本在下载, 那么就不能并行下载其他的组件.因为脚本可能会使用类似<code>document.write</code>等方式对页面渲染产生影响, 所以浏览器会等待脚本的下载来确保正确的布局, 并且不让并行下载可以保证脚本的执行顺序.</p>
<h2 id="css">避免css表达式</h2>
<p>这东西不太熟, 说是有些时候会影响页面的加载速度, 比较危险, 所以建议不要使用(非常了解除外).</p>
<h2 id="cssjs">使用外部的css和js</h2>
<p>内联的js和css会使文档过大, 并且不利于代码重用,  影响页面加载速度, 但是却会减少HTTP请求.但实际上, 由于CDN和浏览器缓存的存在, 使得内联js和css让文档过大的缺点变得非常明显, 所以要尽量使用外部的css和js.</p>
<h2 id="dns">减少DNS查找</h2>
<p>通过使用Keep-Alive和较少的域名来减少DNS查找</p>
<h2 id="js">精简js</h2>
<p>压缩和精简js代码能够减少网络传输的时间开销</p>
<h2 id="_5">避免重定向</h2>
<p>使用了重定向, 当最终的html请求到之前, 不会有任何的组件的下载和页面渲染.虽然使用重定向能很方便自然的解决问题, 但是性能上带来的损害是无法弥补的.所以尽量使用一些替代方案</p>
<h2 id="_6">移除重复脚本</h2>
<p>自己注点意</p>
<h2 id="etag">配置Etag</h2>
<p><code>ETag</code>是<code>If-Modified-Since</code>的增强(<code>If-Modified-Since</code>只能精确到秒), 会在http头中增加<code>If-None-Match</code>信息. 但是, 当在集群环境下ETag会导致缓存失效, 因此需要根据实际情况开始或关闭ETag.</p>
<h2 id="ajax">使Ajax可缓存</h2>
<p>确保Ajax请求遵循性能指导, 尤其应具有长久的<code>Expires</code>头.</p>
    </div>

        </div>
        <div id="footer">
            <span>
                Copyright © now-forever crow.
                Powered by <a href="https://github.com/wlwang41/cb" target="_blank">Cb</a>.
                UI by <a href="https://github.com/tankywoo/wiki.tankywoo.com">yasimple</a>
            </span>
        </div>
    </body>
</html>